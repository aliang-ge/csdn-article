> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/qq_61778128/article/details/125750360)

前言
--

[LSB](https://so.csdn.net/so/search?q=LSB&spm=1001.2101.3001.7020) 全称为 least significant bit，是最低有效位的意思。Lsb 图片隐写是基于 lsb 算法的一种图片隐写术，以下统称为 lsb 隐写，这是一种常见的信息隐藏方法。当然关于图像的隐写的方法有很多，统称为隐写术， lsb 隐写很实用，算法简单，能存储的信息量也大，是 CTF 比赛中的常客。

#### 隐写术简介

先简单的讲讲什么是隐写。由于我们识别声音或图片的能力有限，因此稍微改动信息的某一位是不会影响我们识别声音或图片的。隐写和加密之间的相同点就是，都是需要经过特殊的处理才能获得特定的信息。它们之间的不同点简单的说就是，加密的话会是一些奇怪的字符，或数据。隐写的话，就是信息明明就在眼前，但是你却视而不见。

#### **Lsb 隐写**

其实吧一开始我是想把一大堆算法理论和公式摆上来讲讲 lsb 隐写是什么，但是想想，这种做法是真的可恶啊，摆明不想让人看嘛。所以我想先从一道例题出发，原理什么的将在这个过程中，细细地讲来。 先来看下面一张图，这道题来自实验吧（原题链接：[实验吧平台升级维护中](http://www.shiyanbar.com/ctf/1897 "实验吧平台升级维护中")），题目名字叫 -- 最低位的轻吻。

![](https://img-blog.csdnimg.cn/721b8165963a4e22a42fef88c052fa92.png)

打开看是一张很著名的图片 ----- 胜利之吻。图片是 bmp 格式。看到题目中有最低位几个字，如果是对隐写类的题目熟悉的话就能一下子想到是 lsb 隐写。因为 lsb 隐写就是利用的图像中的最低有效位。最低有效位这个词在前文中出现很多次了，但是到底是什么意思呢？ 首先来讲 png 图片，png 图片是一种无损压缩的位图片形格式，也只有在无损压缩或者无压缩的图片（BMP）上实现 lsb 隐写。如果图像是 jpg 图片的话，就没法使用 lsb 隐写了，原因是 jpg 图片对像数进行了有损压缩，我们修改的信息就可能会在压缩的过程中被破坏。而 png 图片虽然也有压缩，但却是无损压缩，这样我们修改的信息也就能得到正确的表达，不至于丢失。BMP 的图片也是一样的，是没有经过压缩的。BMP 图片一般是特别的大的，因为 BMP 把所有的像数都按原样储存，没有进行压缩。 png 图片中的图像像数一般是由 RGB 三原色（红绿蓝）组成，每一种颜色占用 8 位，取值范围为 0x00~0xFF，即有 256 种颜色，一共包含了 256 的 3 次方的颜色，即 16777216 种颜色。而人类的眼睛可以区分约 1000 万种不同的颜色，这就意味着人类的眼睛无法区分余下的颜色大约有 6777216 种。

![](https://img-blog.csdnimg.cn/cc50cc62e92442b78402931e0be29361.png)

LSB 隐写就是修改 RGB 颜色分量的最低二进制位也就是最低有效位（LSB），而人类的眼睛不会注意到这前后的变化，每个像数可以携带 3 比特的信息。

![](https://img-blog.csdnimg.cn/d926dc9db0684c81935e54c8ceee771e.png)

上图我们可以看到，十进制的 235 表示的是绿色，我们修改了在二进制中的最低位，但是颜色看起来依旧没有变化。我们就可以修改最低位中的信息，实现信息的隐写。我修改最低有效位的信息的算法就叫做 lsb 加密算法，提取最低有效位信息的算法叫做 lsb 解密算法。 再放两张图加深下理解：

![](https://img-blog.csdnimg.cn/4e9cb81be3ce4a16a53936ebe0a0f7fb.png)

回到题目上来，这里我们使用一款功能很强大的 lsb 隐写分析工具 ---StegSolve 图片通道查看器（下载地址：[http://www.caesum.com/handboo...](https://link.segmentfault.com/?enc=mEvpM4XrvEThXpQS9t7Vhw%3D%3D.0%2FBupE8MT94ORJRJpNk24q2mM%2FGXjWn88F9TgRRLGYbBWvmgsNkPGptr2rK1i2ZG "http://www.caesum.com/handboo...")）。 使用过 photoshop 的朋友应该对图片通道有些概念，一幅完整的图像，红色绿色蓝色三个通道缺一不可。一幅图像，如果关闭了红色通道，那么图像就偏青色。如果关闭了绿色通道，那么图像就偏洋红色。如果关闭了蓝色通道，那么图像就偏黄色。当然还有个 Alpha 通道，是一个 8 位的灰度通道，也可以理解为透明度（粗糙的理解）。关于图像通道详细的讲解可以自行百度，这里不再详细说明。 使用 stegsolve 打开图片，按右方向键查看各通道显示的图像。一般有些题目会在某一个图像通道中直接显示出 flag，但是显然这题不行，看来还需要绕些弯，要获取最低位的图片信息。 所以这道题的思路就是将图片转换成 0,1 像素点（图像处理问题），这里可以直接使用 MATLAB（MATLAB 特别适合图像处理，而且语法特别特别简单）： 在命令行窗口输入以下命令：

```
filename='01.bmp';
imfinfo(filename);
A = imread(filename);
B = logical(bitget(A,1));
imshow(B);
```

指令详解：

![](https://img-blog.csdnimg.cn/783da8c4af644429bf19d5e09b89a996.png)

运行得结果如下。扫描这个二维码，就能直接得到 flag，有兴趣的朋友可以自己动手扫一下。

![](https://img-blog.csdnimg.cn/0ba0900c154644f59d6ffe9d4cf3155f.png)

这里还可以使用其他的编程算法来解，原理都是一样的，但如果不会 matlab 语法，该怎么办呢。其实这题还有一种解法，因为只是简单的获取最后一位然后画图，但是为啥 stegsolve 获取不到呢。 我们先来看下图像信息：

发现是 bmp 的 8 位灰度图。猜测是 StegSolve 解析 8 位的 BMP 存在问题？

常见的 8 位通道 RGB 图像，3 个通道共 24 位，即一张 24 位 RGB 图像里可表现大约 1670 万种颜色；而 16 位通道 RGB 图像，3 个通道共 48 位，2 的 48 次方是多少种颜色。32 位深度 CMYK（8 位 ×4 通道）。 这里的 8 位、16 位、32 位指颜色深度（Color Depth）用来度量图像中有多少颜色信息可用于显示或打印像素，其单位是 “位（Bit）”，所以颜色深度有时也称为位深度。 常用的颜色深度是 1 位、8 位、24 位和 32 位。1 位有两个可能的数值：0 或 1。较大的颜色深度（每像素信息的位数更多）意味着数字图像具有较多的可用颜色和较精确的颜色表示。

试试转换成 png 格式呢再看看呢？用画图另存为 png 格式（不能直接改后缀）。此时发现文件变大，图像信息如下图：

![](https://img-blog.csdnimg.cn/c418aabc418f4d368820be1e0f649d17.png)

用 StegSolve 打开后，在 RGB 的最后一位看到二维码。（原图在保存的时候显示的类型是 256 色位图，就是位深度为 8，如果保存为 24 位位图的 bmp 格式，不转换为 png 格式，也能用 StegSolve 找到如上图的二维码。）

![](https://img-blog.csdnimg.cn/3765afe732f1423390f6fde82472fb6b.png)

所以我们改变图片位深度，就能得到其中的二维码信息。

#### LSB 隐写的变形题

经过上面的例子，我们基本上了解了什么是 lsb 隐写。一般的 lsb 隐写我们都能使用工具或者编写程序提取到图片的最低有效位信息，从而得到其中的内容。但是出题人的脑洞不局限于此，lsb 隐写还有各种扩展的使用方法。下面是网鼎杯第一场中的一道杂项题，也是一道 lsb 隐写题。不同的是，光提取最低有效位是不能进行解答的。 首先给我们的是一张花花的图是 png 格式。题目名字是 minify，使变小的意思，那应该就是指 lsb 隐写。

![](https://img-blog.csdnimg.cn/ccf122f280b64e1384e3318d0bd1eb2c.png)

光凭肉眼是真的什么也看不出，我们借助于工具 StegSolve 进行分析。 一路翻下去，除了花花的还是花花的，唯一值得怀疑的地方就在 red plane 0 这里是纯黑，

![](https://img-blog.csdnimg.cn/a78325d4b6e84f42aaaf6e1f97961138.png)

![](https://img-blog.csdnimg.cn/0699191487f544df918f56b3aeb4906a.png)

说明这里什么也没有，正常的图片都不会是这样子的，其它通道也都显示正常。所以这个异常给我们什么启示呢？从这里可以真正确定是 lsb 隐写了。

那我们要从其他的通道比如：blue、alpha、green 中找些到信息。整张图片看起来是毫无规则的像素点，那一定想把真正的信息隐藏起来，再用一些毫无规则的像素点干扰我们。我们如果想得到其中的信息，就要去掉这些干扰点。但是到底去掉哪些呢。经过前面的步骤我们知道了信息可能隐藏在 plane 0 中，所以我们要先把各个通道的 plane 0 提取出来。Red plane 0 因为是空信息，可以不用提取了。我们提取出（File->Save as）Green plane 0、Alpha plane 0、Blue plane 0，把他们各另存为一张图。然后各个图进行比对（Analyse->image Combiner），最后发现 Alpha plane 0 和 Green plane 0 异或运算下的图出现了 flag

![](https://img-blog.csdnimg.cn/dc5690029d8c4b8ab88cee2721018fa5.png)

异或对比常常是为了检查两张图片之间的差异，能发现我们肉眼看不到的及细微的差异。

![](https://img-blog.csdnimg.cn/1d89435bd2c94ad792cddfba79ea62e2.png)

上图是异或（XOR）对比出一张图片中的区别，所以用这个方法，也能把我们的信息隐藏在其中，但我觉得这并不是一种实用的方法。

#### 后话

CTF 中有关隐写术的这类题目真的是考验脑洞了，扩展开讲，还有能有很多很多可以举例的。Lsb 隐写还能结合其他的隐写术，不只是能隐藏一些图片，还能把文件写入其中。这类题目这就需要用其他的工具进行文件提取分离，比如 binwalk 和 foremost。当然，万变不离其宗，这里我们只要把原理搞清楚就足够了，剩下的就是解题思路，这就需要开开脑洞了。网上也存在着很多优秀的 lsb 隐写算法，能够实现更多复杂的操作，有兴趣的朋友可以进一步的去了解。